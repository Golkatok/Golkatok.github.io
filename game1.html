<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä 3.0 (–õ–æ–∫–∞–ª—å–Ω—ã–π –ó–≤—É–∫)</title>
    <style>
        body {
            background-color: #222; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation; 
        }

        #game-container {
            position: relative;
            width: 100%; 
            max-width: 800px;
            height: 400px; 
            border: 5px solid #fff;
            background-color: #55aaff; 
            overflow: hidden;
        }

        #player {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #ff5555; 
            bottom: 50px; 
            left: 50%; 
            transform: translateX(-50%);
            transition: background-color 0.1s;
        }

        #ground {
            position: absolute;
            width: 100%;
            height: 50px;
            background-color: #4CAF50; 
            bottom: 0;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        #controls {
            position: absolute;
            bottom: 10px;
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .control-button {
            width: 80px;
            height: 80px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 30px;
            line-height: 80px;
            text-align: center;
            border-radius: 10px;
            user-select: none;
            cursor: pointer;
            border: 2px solid white;
        }
        #jump-button {
            position: absolute;
            right: 20px;
            bottom: 100px;
            background-color: rgba(0, 255, 0, 0.6);
        }

        #sound-hint {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: yellow;
            font-family: sans-serif;
            font-size: 14px;
            z-index: 10;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="sound-hint">–ù–∞–∂–º–∏ –≥–¥–µ-–Ω–∏–±—É–¥—å, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É!</div>
    <div id="ground"></div>
    <div id="player"></div>
</div>

<div id="controls">
    <div class="control-button" id="left-button" ontouchstart="moveStart(-1)" ontouchend="moveEnd()" onmousedown="moveStart(-1)" onmouseup="moveEnd()">‚¨ÖÔ∏è</div>
    <div class="control-button" id="right-button" ontouchstart="moveStart(1)" ontouchend="moveEnd()" onmousedown="moveStart(1)" onmouseup="moveEnd()">‚û°Ô∏è</div>
    <div class="control-button" id="jump-button" ontouchstart="jump()" onmousedown="jump()">‚¨ÜÔ∏è</div>
</div>

<script>
    // üéß –ó–≤—É–∫–∏! üéß
    // –¢–≤–æ—è –ª–æ–∫–∞–ª—å–Ω–∞—è –º—É–∑—ã–∫–∞
    const backgroundMusic = new Audio('music/Music1 (prod. penguinmusic).mp3'); 
    backgroundMusic.loop = true; 
    backgroundMusic.volume = 0.3; 

    // –ó–≤—É–∫ –ø—Ä—ã–∂–∫–∞ - –æ—Å—Ç–∞–≤–∏–ª –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
    const jumpSound = new Audio(''); 
    
    let musicStarted = false;
    const soundHint = document.getElementById('sound-hint');


    // üïπÔ∏è –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
    const player = document.getElementById('player');
    
    // –§–∏–∑–∏–∫–∞/–î–≤–∏–∂–µ–Ω–∏–µ (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∫–æ–¥–∞)
    let gravity = 0.8; 
    let velocityY = 0; 
    let isJumping = false;
    let playerY = 50; 
    let playerX = 400; 
    const groundHeight = 50; 
    const jumpPower = 15; 
    const moveSpeed = 5;
    let moveDirection = 0; 
    const playerWidth = 30;
    const containerWidth = 800;
    
    function gameLoop() {
        // --- –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏ –∑–¥–µ—Å—å ---
        if (!musicStarted) {
            backgroundMusic.play()
                .then(() => {
                    // –ú—É–∑—ã–∫–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å, —É–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                    musicStarted = true;
                    soundHint.style.display = 'none';
                })
                .catch(e => {
                    // –ú—É–∑—ã–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–æ–º, –∂–¥–µ–º –∫–ª–∏–∫–∞
                    console.log("–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.");
                });
        }
        
        // --- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ñ–∏–∑–∏–∫–∞ ---
        if (playerY > groundHeight || velocityY > 0) {
            velocityY -= gravity;
            playerY += velocityY;
        }
        
        if (playerY <= groundHeight) {
            playerY = groundHeight; 
            velocityY = 0; 
            isJumping = false; 
        }
        
        // --- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ ---
        if (moveDirection !== 0) {
            playerX += moveDirection * moveSpeed;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
            if (playerX < playerWidth / 2) {
                playerX = playerWidth / 2;
            }
            if (playerX > containerWidth - playerWidth / 2) {
                playerX = containerWidth - playerWidth / 2;
            }
            
            player.style.backgroundColor = '#55ff55'; 
        } else {
            player.style.backgroundColor = '#ff5555'; 
        }

        // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π ---
        player.style.bottom = playerY + 'px';
        player.style.left = playerX + 'px';
        player.style.transform = `translateX(-50%)`; 
        
        requestAnimationFrame(gameLoop);
    }

    // --- –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ---

    function jump() {
        if (!isJumping) {
            isJumping = true;
            velocityY = jumpPower; 
            jumpSound.currentTime = 0; 
            jumpSound.play().catch(e => console.log("–ó–≤—É–∫ –ø—Ä—ã–∂–∫–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è"));
        }
    }

    function moveStart(direction) {
        moveDirection = direction;
    }

    function moveEnd() {
        moveDirection = 0;
    }
    
    // --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (PC) ---
    document.addEventListener('keydown', (event) => {
        if (event.code === 'Space') {
            jump();
        } else if (event.code === 'KeyA' || event.code === 'ArrowLeft') {
            moveStart(-1);
        } else if (event.code === 'KeyD' || event.code === 'ArrowRight') {
            moveStart(1);
        }
    });

    document.addEventListener('keyup', (event) => {
        if (event.code === 'KeyA' || event.code === 'ArrowLeft' || event.code === 'KeyD' || event.code === 'ArrowRight') {
            moveEnd();
        }
    });

    // *** –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º—É–∑—ã–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ ***
    // –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±—Ä–∞—É–∑–µ—Ä–∞, –µ—Å–ª–∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
    document.addEventListener('click', () => {
        if (!musicStarted) {
            backgroundMusic.play().then(() => {
                musicStarted = true;
                soundHint.style.display = 'none';
            }).catch(e => {});
        }
    }, { once: true });


    // --- –ó–∞–ø—É—Å–∫ ---
    gameLoop();
</script>

</body>
</html>
