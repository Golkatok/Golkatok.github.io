<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spotify Redirect</title>
  <style>
    :root {
      --bg: #0e1217;
      --accent: #1db954;
      --text: #e5f4ec;
      --muted: #9fb4a8;
      font-family: Inter, system-ui, sans-serif;
    }
    body {
      margin: 0;
      background: linear-gradient(180deg, var(--bg), #05080b);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
    }
    .card {
      background: rgba(255,255,255,0.03);
      border-radius: 14px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.4);
      padding: 30px;
      max-width: 600px;
      width: 92%;
      text-align: center;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.05);
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 10px;
      color: var(--accent);
    }
    p {
      color: var(--muted);
      margin-bottom: 20px;
    }
    code {
      background: rgba(255,255,255,0.08);
      padding: 4px 6px;
      border-radius: 6px;
      font-family: monospace;
    }
    .token-box {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 10px;
      margin-top: 12px;
      font-family: monospace;
      word-break: break-all;
    }
    .success { color: var(--accent); }
    .error { color: #ff6b6b; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Spotify Authorization Callback</h1>
    <p id="status">Обработка перенаправления...</p>
    <div id="token" class="token-box" style="display:none"></div>
  </div>

  <script>
    (function(){
      function parseParams(source) {
        if (!source) return {};
        const clean = source.replace(/^#|^\?/, '');
        return Object.fromEntries(new URLSearchParams(clean));
      }

      const query = parseParams(window.location.search);
      const hash = parseParams(window.location.hash);
      const statusEl = document.getElementById('status');
      const tokenBox = document.getElementById('token');

      if (query.code) {
        statusEl.innerHTML = '<span class="success">Код успешно получен!</span><br>Теперь можно обменять его на токен.';
        tokenBox.style.display = 'block';
        tokenBox.textContent = 'code=' + query.code;
        localStorage.setItem('spotify_code', query.code);
      } else if (hash.access_token) {
        statusEl.innerHTML = '<span class="success">Токен успешно получен!</span>';
        tokenBox.style.display = 'block';
        tokenBox.textContent = 'access_token=' + hash.access_token;
        localStorage.setItem('spotify_access_token', hash.access_token);
      } else if (query.error) {
        statusEl.innerHTML = '<span class="error">Ошибка авторизации: ' + query.error + '</span>';
      } else {
        statusEl.textContent = 'Не удалось найти код или токен в URL.';
      }

      // Очистка URL от чувствительных данных
      if (window.history.replaceState) {
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    })();
  </script>
</body>
</html>
